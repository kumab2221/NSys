# CSVNodeEditor 要件定義書

## 概要

CSVNodeEditorは、NSysプラットフォーム上で動作するノードベースのCSVデータ処理ツールです。ImGui、ImNodes、ImPlotを使用し、直感的なドラッグ&ドロップインターフェースでCSVデータの視覚的な処理フローを構築できます。

## ユーザストーリー

### ストーリー1: データアナリスト

- **である** データアナリスト **として**
- **私は** CSVファイルを視覚的なノードで処理したい
- **そうすることで** 複雑なデータ変換処理をプログラミングなしで実現できる

### ストーリー2: ビジネスユーザー

- **である** ビジネスユーザー **として**
- **私は** 複数のCSVファイルを統合・分析したい
- **そうすることで** 迅速な意思決定のためのデータインサイトを得られる

### ストーリー3: データエンジニア

- **である** データエンジニア **として**
- **私は** 再利用可能なデータ処理ワークフローを構築したい
- **そうすることで** 標準化されたデータパイプラインを効率的に運用できる

## 機能要件（EARS記法）

### 通常要件

- REQ-001: システムは CSVファイルを読み込んでデータを表示しなければならない
- REQ-002: システムは ノードベースのデータフロー表示を提供しなければならない
- REQ-003: システムは 複数タブでの並行編集を支援しなければならない
- REQ-004: システムは Dockingウィンドウシステムに対応しなければならない
- REQ-005: システムは 処理結果をCSVファイルとして出力しなければならない

### CSVデータ処理要件

- REQ-011: システムは カンマ区切り形式のCSVファイルを読み込みしなければならない
- REQ-012: システムは CSVデータをテーブル形式で表示しなければならない
- REQ-013: システムは CSVヘッダー行を適切に識別しなければならない
- REQ-014: システムは データ型（文字列、数値、日付）を自動判定しなければならない

### ノード機能要件

- REQ-021: システムは CSV読み込みノードを提供しなければならない
- REQ-022: システムは フィルターノードによるデータ絞り込みを提供しなければならない
- REQ-023: システムは ソートノードによるデータ並び替えを提供しなければならない
- REQ-024: システムは 集計ノードによるデータ要約を提供しなければならない
- REQ-025: システムは 結合ノードによる複数データセットの結合を提供しなければならない
- REQ-026: システムは CSV出力ノードを提供しなければならない

### UI表示要件

- REQ-031: システムは メニューバーによるファイル操作を提供しなければならない
- REQ-032: システムは タブバーによる複数フロー管理を提供しなければならない
- REQ-033: システムは ノードパレットによる利用可能ノード一覧を表示しなければならない
- REQ-034: システムは プロパティパネルによるノード設定を提供しなければならない
- REQ-035: システムは データプレビューによるCSV内容表示を提供しなければならない
- REQ-036: システムは ログパネルによる処理状況表示を提供しなければならない

### 条件付き要件

- REQ-101: CSVファイルがロックされている場合、システムは読み取り専用モードで開かなければならない
- REQ-102: データが大容量の場合、システムは段階的読み込み機能を提供しなければならない
- REQ-103: ノード接続が循環参照を形成する場合、システムは警告を表示しなければならない
- REQ-104: 必須入力パラメータが未設定の場合、システムは実行を停止しなければならない

### 状態要件

- REQ-201: ノードが実行中状態にある場合、システムは進捗インジケーターを表示しなければならない
- REQ-202: エラー状態にある場合、システムは該当ノードを赤色でハイライトしなければならない
- REQ-203: データが変更された状態にある場合、システムは保存必要フラグを表示しなければならない

### オプション要件

- REQ-301: システムは プロジェクトファイルとして処理フローを保存してもよい
- REQ-302: システムは Undo/Redo機能を提供してもよい
- REQ-303: システムは バッチ処理機能を提供してもよい
- REQ-304: システムは カスタムノード追加機能を提供してもよい

### 制約要件

- REQ-401: システムは 10万行以下のCSVデータを効率的に処理しなければならない
- REQ-402: システムは Windows環境でのみ動作しなければならない
- REQ-403: システムは メモリ使用量を500MB以下に制限しなければならない

## 非機能要件

### パフォーマンス

- NFR-001: システムは 10万行のCSVファイルを30秒以内に読み込みしなければならない
- NFR-002: システムは データフィルタリングを1秒以内に完了しなければならない
- NFR-003: システムは ノード描画を60FPSで維持しなければならない
- NFR-004: システムは 同時に5つのタブまでを効率的に管理しなければならない

### セキュリティ

- NFR-101: システムは ファイルパスの妥当性検証を実行しなければならない
- NFR-102: システムは 悪意のあるCSVファイルの実行を防がなければならない
- NFR-103: システムは 機密データの不適切な出力を防ぐ警告を表示しなければならない

### ユーザビリティ

- NFR-201: システムは 直感的なドラッグ&ドロップ操作を提供しなければならない
- NFR-202: システムは ノード接続の視覚的フィードバックを提供しなければならない
- NFR-203: システムは 日本語UIを適切に表示しなければならない
- NFR-204: システムは キーボードショートカット操作を支援しなければならない

### 互換性

- NFR-301: システムは 標準CSV形式（RFC 4180準拠）をサポートしなければならない
- NFR-302: システムは Excel出力CSVとの互換性を維持しなければならない
- NFR-303: システムは UTF-8およびShift-JIS エンコーディングをサポートしなければならない

## ノード仕様

### データ入力ノード

#### CSV読み込みノード
- **機能**: CSVファイルを読み込みデータを出力
- **パラメータ**: ファイルパス、エンコーディング、区切り文字、ヘッダー有無
- **出力**: テーブルデータ

### データ処理ノード

#### フィルターノード
- **機能**: 条件に基づいてデータを絞り込み
- **パラメータ**: 対象列、条件演算子、比較値
- **入力**: テーブルデータ
- **出力**: フィルター済みテーブルデータ

#### ソートノード
- **機能**: 指定列でデータを並び替え
- **パラメータ**: ソート列、昇順/降順
- **入力**: テーブルデータ
- **出力**: ソート済みテーブルデータ

#### 集計ノード
- **機能**: グループ別の集計処理
- **パラメータ**: グループ列、集計関数（合計、平均、最大、最小、件数）
- **入力**: テーブルデータ
- **出力**: 集計結果テーブルデータ

#### 結合ノード
- **機能**: 2つのデータセットを結合
- **パラメータ**: 結合種類（内部、左外部、右外部、完全外部）、結合キー
- **入力**: テーブルデータ×2
- **出力**: 結合済みテーブルデータ

### データ出力ノード

#### CSV出力ノード
- **機能**: データをCSVファイルとして保存
- **パラメータ**: 出力パス、エンコーディング、区切り文字
- **入力**: テーブルデータ

## Edgeケース

### エラー処理

- EDGE-001: CSVファイルが存在しない場合のエラーハンドリング
- EDGE-002: CSVファイル形式が不正な場合の警告表示
- EDGE-003: メモリ不足時のグレースフルデグラデーション
- EDGE-004: ノード実行中のキャンセル処理
- EDGE-005: 出力先ディレクトリが存在しない場合の自動作成

### 境界値処理

- EDGE-101: 空のCSVファイルの処理
- EDGE-102: 1行のみのCSVファイル（ヘッダーのみ）の処理
- EDGE-103: 非常に長い行を持つCSVファイルの処理
- EDGE-104: 特殊文字（改行、タブ、引用符）を含むセルの処理
- EDGE-105: 数値の最大・最小値を含むデータの処理

### データ品質

- EDGE-201: NULL値・空文字の適切な処理
- EDGE-202: 不正な日付形式のデータ処理
- EDGE-203: 文字エンコーディング混在データの処理
- EDGE-204: 極端に大きな数値の処理
- EDGE-205: 重複データの識別と処理

### UI/UX

- EDGE-301: ウィンドウサイズ変更時のレイアウト調整
- EDGE-302: 複数モニター環境での表示
- EDGE-303: 高DPI環境での適切な表示
- EDGE-304: ノード数が多い場合の描画パフォーマンス
- EDGE-305: 長時間操作後のUI応答性維持

## 受け入れ基準

### 基本機能テスト

- [ ] CSVファイルの読み込み・表示
- [ ] ノードの作成・削除・移動
- [ ] ノード間の接続・切断
- [ ] 複数タブでの同時編集
- [ ] 処理結果のCSV出力
- [ ] プロパティパネルでの設定変更
- [ ] データプレビューでの内容確認

### データ処理テスト

- [ ] フィルター機能による条件絞り込み
- [ ] ソート機能による並び替え
- [ ] 集計機能による要約処理
- [ ] 結合機能による複数データ統合
- [ ] 10万行データでの性能確認
- [ ] 各種データ型（文字列、数値、日付）の適切な処理

### UI/UXテスト

- [ ] ドラッグ&ドロップ操作の直感性
- [ ] ノード接続時の視覚的フィードバック
- [ ] Dockingウィンドウの動作確認
- [ ] 日本語表示の正確性
- [ ] キーボードショートカットの動作
- [ ] エラーメッセージの適切な表示

### パフォーマンステスト

- [ ] 大容量CSVファイル（10万行）の処理時間
- [ ] リアルタイムデータ更新での描画性能
- [ ] メモリ使用量の制限内での動作
- [ ] 長時間動作でのメモリリーク検証
- [ ] 複数タブ同時使用時の性能維持

### 例外処理テスト

- [ ] 不正CSVファイルの処理
- [ ] ファイルアクセス権限エラーの処理
- [ ] ネットワークドライブでの動作
- [ ] ディスク容量不足時の処理
- [ ] システムリソース不足時の動作

### 統合テスト

- [ ] NSysメインアプリケーションとの連携
- [ ] 他プラグインとの同時動作
- [ ] プラグインの動的読み込み・アンロード
- [ ] 設定情報の永続化
- [ ] セッション間でのデータ復旧